# Швидкий старт з SDK для Node.js

[Посилання на оригінальну статтю](https://cloud.ibm.com/docs/cloud-foundry-public?topic=cloud-foundry-public-getting-started-node)

Керуючись цим посібником, Ви налаштуєте середовище розробки, розгорнете програму локально на IBM Cloud® та інтегруєте службу баз даних IBM Cloud у свою програму.

У цих документах посилання на Cloud Foundry CLI, який тепер оновлено до IBM Cloud CLI! IBM Cloud CLI має ті самі звичні команди Cloud Foundry, але з кращою інтеграцією з обліковими записами IBM Cloud та іншими службами. Дізнайтеся більше про початок роботи з IBM Cloud CLI у цьому посібнику.

## Перед початком

Ви потребуєте наступні аккаунти і утиліти:

- [IBM Cloud account](https://cloud.ibm.com/registration)
- [IBM Cloud CLI](https://cloud.ibm.com/docs/cli/reference/ibmcloud?topic=cloud-cli-install-ibmcloud-cli)
- [Git](https://git-scm.com/downloads)
- [Node](https://nodejs.org/en/)

## Крок 1: Clone the sample app

Спочатку, клонуйте приклад Node.js *hello world* з GitHub репозиторію.

```bash
git clone https://github.com/IBM-Cloud/get-started-node
```

## Крок 2: Запуск застосунку локально

Використовуючи npm package manager встановіть залежності і запустіть застосунок локально. Для цього зробіть наступні дії:

1. У командному рядку змініть каталог на те, де знаходиться програма.

```bash
cd get-started-node
```

2. Встановіть підлеглі пакунки перераховані в файлі [package.json](https://docs.npmjs.com/files/package.json) для локального запуску.                

```bash
npm install
```

3. Запустіть застосунок.

```bash
npm start
```

4. Відкрийте в браузері наступне посилання URL: http://localhost:3000

За необхідності можете використайте [nodemon](https://nodemon.io/) для автоматичного рестарту при зміні застосунку.

## Крок 3: Підготовка застосунку для розгортання 

Для розгортання в IBM Cloud може бути корисно встановити файл manifest.yml. Файл manifest.yml містить основну інформацію про вашу програму, таку як назву, скільки пам'яті виділити для кожного екземпляра та маршрут. Ми надали зразок файлу manifest.yml у каталозі `get-started-node`.

Відкрийте файл manifest.yml і змініть `name` з ` GetStartedNode` на ім'я вашої програми, app_name.

```yaml
applications:
- name: GetStartedNode
  random-route: true
  memory: 128M
```

У цьому файлі manifest.yml **random-route: true** генерує випадковий маршрут для вашого застосунку, щоб запобігти зіткненню вашого маршруту з іншими. Якщо ви вирішите, ви можете замінити **random-route: true** на **host: myChosenHostName**, надавши ім’я хосту на ваш вибір.

## Крок 4: Розгортання застосунку

Ви можете використати IBM Cloud CLI для розгортання застосунку в IBM Cloud.

1. Увійдіть у Ваш IBM Cloud аккаунт і виберіть API endpoint.

```bash
ibmcloud login
```

2. Вкажіть кінцеві Cloud Foundry org та space:

```bash
ibmcloud target --cf
```

Якщо у Вас немає org або space, створіть їх, див [Adding orgs and spaces](https://cloud.ibm.com/docs/account?topic=account-orgsspacesusers).

3. Зсередини директорії застосунку *get-started-node*, завантажте ваш застосунок в IBM Cloud.

```bash
ibmcloud cf push
```

Розгортання програми може зайняти кілька хвилин. Коли розгортання завершиться, ви побачите повідомлення про те, що ваш застосунок запущений. Перегляньте свою програму за URL-адресою, вказаною у вихідних даних команди push, або перегляньте на стан розгортання програми, так і URL-адресу, виконавши таку команду:

```bash
ibmcloud cf apps
```

Ви також можете перейти до IBM Cloud [resource list](https://cloud.ibm.com/resources), щоб переглянути свій застосунок.

Ви можете усунути помилки в процесі розгортання за допомогою команди `ibmcloud cf logs <Your-App-Name> --recent`

## Крок 5: Добавлення бази даних

Далі ми додамо базу даних IBM Cloudant NoSQL до цієї програми та налаштуємо програму так, щоб вона могла працювати локально та на IBM Cloud.

1. У своєму браузері увійдіть до IBM Cloud і перейдіть на інформаційну панель. Виберіть **Create resource**.
2. Знайдіть **IBM Cloudant** та виберіть сервіс.
3. Для **Available authentication methods**, виберіть **Use both legacy credentials та IAM**.  Ви можете залишити налаштування за замовчуванням для інших полів. Натисніть **Create** для створення сервісу.
4. В навігації перейдіть до **Connections**, тоді натисніть **Create connection**. Виберіть ваш застосунок і натисніть **Connect**.
5. Використовуючи значення за замовченням натисніть **Connect & restage app** для підключення бази даних до вашого застосунку. Натисніть **Restage** при запиті.

IBM Cloud перезапустить вашу програму та надасть вашій програмі облікові дані бази даних за допомогою змінної середовища `VCAP_SERVICES`. Ця змінна середовища доступна для програми лише тоді, коли вона працює на IBM Cloud.

Змінні середовища дозволяють вам відокремити параметри розгортання від вихідного коду. Наприклад, замість жорсткого кодування пароля бази даних, ви можете зберігати його у змінній середовища, на яку ви посилаєтесь у своєму вихідному коді.

## Крок 6: Використання бази даних

Тепер ми будемо оновлювати ваш локальний код, щоб вказувати на цю базу даних. Ми створимо файл JSON, який буде зберігати облікові дані служб, якими буде користуватися програма. Цей файл буде використаний ТІЛЬКИ, коли програма працює локально. При роботі в IBM Cloud облікові дані будуть зчитуватися із змінної середовища `VCAP_SERVICES`.

1. У директорії `get-started-node`, створіть файл з назвою `vcap-local.json` з наступним вмістом:

```bash
{
 "services": {
   "cloudantNoSQLDB": [
     {
       "credentials": {
         "url":"CLOUDANT_DATABASE_URL"
       },
       "label": "cloudantNoSQLDB"
     }
   ]
 }
}
```

2. Знайдіть Ваш App в IBM Cloud [resource list](https://cloud.ibm.com/resources). На сторінці Service Details вашого затосунку, натисніть **Connections** на боковій панелі. Натсиніть іконку меню (**…**)  IBM Cloudant та виберіть **View credentials**.

3. Зкопюйте та вставет `url` з credentials в поле `url` файлу `vcap-local.json`, замінюючи  `CLOUDANT_DATABASE_URL`.

4. Запустіть ваш застосунко локально.

```bash
npm start
```

Подивіться http://localhost:3000. Усі введені в програму імена тепер додаватимуться до бази даних.

**Уникайте проблем**: IBM Cloud означує змінну середовища PORT, коли ваш застосунко працює на хмарі. Коли ви запускаєте програму локально, змінна PORT не визначена, тому використовується як номер порту 3001. Для отримання додаткової інформації див. [Run your app locally](https://cloud.ibm.com/docs/cloud-foundry?topic=cloud-foundry-hints).

Ваша локальна програма та програма IBM Cloud спільно використовують базу даних. Імена, які ви додаєте з будь-якої програми, відображатимуться в обох, коли ви оновите веб-переглядачі.

Пам'ятайте, якщо вам не потрібна ваша програма в реальному часі на IBM Cloud, зупиніть програму, щоб не стягувати несподіваних платежів.